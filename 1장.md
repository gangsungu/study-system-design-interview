## 사용자 수에 따른 규모 확장성

### 단일서버
+ 사용자 요청이 처리되는 과정
    - 사용자는 도메인 이름(api.mysite.com)을 이용하여 웹사이트에 접속
    - 접속을 위해서는 도메인 이름을 도메인 이름 서비스(DNS)에 질의하여 IP로 변환하는 과정이 필요
    - 변환된 IP 주소로 HTTP 요청을 전달
    - 요청을 받은 웹 서버는 HTML 페이지나 JSON 형태의 응답을 반환

### 데이터베이스
사용자가 늘어나면 하나의 서버에서 모든 요청을 처리하기 어렵다  
그래서 서버를 하나는 웹/모바일 트래픽 처리 용도, 다른 하나는 데이터베이스용으로 나눈다  
이렇게 분리하면 서버를 각각 독립적으로 확장해 나갈 수 있다

+ 어떤 데이터베이스를 사용할 것인가
    - 관계형 데이터베이스 (RDBMS)
        + MySQL, Oracle, PostgreSQL 등이 존재
        + 자료를 테이블과 열, 칼럼으로 표현
        + 여러 테이블에 저장된 자료를 join으로 합쳐서 가져올 수 있다
    - 비-관계형 데이터베이스 (NoSQL)
        + HBase, Amazon DynamoD, Cassandra 등이 존재
        + 키-값 저장소, 그래프 저장소, 칼럼 저장소, 문서 저장소로 나눌 수 있다
        + 비관계형 데이터베이스는 Join 연산을 지원하지 않는다
    - 아래와 같은 경우, 비-관계형 데이터베이스가 더 바람직한 선택일 수 있다
        + 아주 낮은 응답시간이 요구됨(latency)
        + 다루는 데이터가 비정형 데이터
        + JSON, YAML, XML 등을 직렬화하거나 역직렬화 해야함
        + 아주 많은 양의 데이터를 저장할 필요가 있음

### 수직적 규모 확장 vs 수평적 규모 확장
+ 수직적 규모 확장
    - 스케일 업
    - 서버에 고사양 자원(CPU, RAM)을 추가하는 행위
    - 서버로 유입되는 트래픽의 양이 적을때는 수직적 확장이 유리
    - 단점
        + 수직적 규모 확장에서는 한계가 있다, 한대의 서버에 CPU나 메모리를 무한으로 증설할 수 없으므로
        + 수직적 규모 확장은 장애에 대한 자동복구나 다중화 방안이 없다, 서버에 장애가 발생하면 웹/앱이 모두 중단됨  

이러한 수직적 규모 확장의 단점을 해소하기 위해 부하 분산기 또는 로드밸런서를 도입해서 처리한다  

+ 로드밸런서가 부하를 분산하는 방법
    - 사용자가 로드밸런서의 공개 IP로 접근한다
        + 웹서버는 클라이언트의 요청을 직접 처리하지 않는다
        + 로드밸런서와 웹서버는 사설 IP로 연결되어 외부에서 웹서버로 직접 접근이 불가능하다
    - 부하분산 집합에 하나의 웹서버를 추가하면 페일오버 문제는 해소되고 웹서버의 가용성은 향상된다

+ 데이터베이스 다중화
    - 마스터-슬레이브 구조
        + 쓰기 연산은 마스터에서만 지원
        + 슬레이브는 마스터로부터 데이터 사본을 전달받고 읽기 연산만 지원한다

### 종합
위에서 언급된 로드밸런서와 데이터베이스 다중화를 고려한 설계안을 확인해보자  
1. 사용자는 DNS로부터 로드밸런서의 공개 IP 주소를 받는다
2. 사용자는 공개 IP 주소를 사용하여 로드밸런서에 접속한다
3. HTTP 요청은 로드밸런서를 통해 여러 대의 서버 중 하나로 전달된다
4. 웹 서버는 사용자의 데이터를 슬레이브 서버에서 읽는다
5. 웹 서버는 데이터 변경 연산은 마스터 서버로 전달한다 (데이터 추가, 삭제, 갱신 등)